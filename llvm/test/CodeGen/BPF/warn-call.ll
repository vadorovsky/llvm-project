; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py UTC_ARGS: --version 6
; RUN: llc -mtriple=bpfel < %s | FileCheck %s

define ptr @warn(ptr returned, ptr, i64) local_unnamed_addr #0 !dbg !6 {
; CHECK-LABEL: warn:
; CHECK:       .Lfunc_begin0:
; CHECK-NEXT:    .file 1 "/w/llvm/bld" "warn_call.c"
; CHECK-NEXT:    .loc 1 5 0 # warn_call.c:5:0
; CHECK-NEXT:    .cfi_startproc
; CHECK-NEXT:  # %bb.0:
; CHECK-NEXT:    #DEBUG_VALUE: warn:dst <- $r1
; CHECK-NEXT:    #DEBUG_VALUE: warn:src <- $r2
; CHECK-NEXT:    #DEBUG_VALUE: warn:len <- $r3
; CHECK-NEXT:    r6 = r1
; CHECK-NEXT:  .Ltmp0:
; CHECK-NEXT:  .Ltmp1:
; CHECK-NEXT:    #DEBUG_VALUE: warn:dst <- $r6
; CHECK-NEXT:    .loc 1 6 2 prologue_end # warn_call.c:6:2
; CHECK-NEXT:  .Ltmp2:
; CHECK-NEXT:    if r3 == 0 goto LBB0_3
; CHECK-NEXT:  .Ltmp3:
; CHECK-NEXT:  .Ltmp4:
; CHECK-NEXT:  # %bb.1: # %loop-memcpy-expansion.preheader
; CHECK-NEXT:    #DEBUG_VALUE: warn:dst <- $r6
; CHECK-NEXT:    #DEBUG_VALUE: warn:len <- $r3
; CHECK-NEXT:    #DEBUG_VALUE: warn:src <- $r2
; CHECK-NEXT:    .loc 1 0 2 is_stmt 0 # warn_call.c:0:2
; CHECK-NEXT:    r4 = 0
; CHECK-NEXT:  .Ltmp5:
; CHECK-NEXT:  .Ltmp6:
; CHECK-NEXT:  LBB0_2: # %loop-memcpy-expansion
; CHECK-NEXT:    # =>This Inner Loop Header: Depth=1
; CHECK-NEXT:    #DEBUG_VALUE: warn:dst <- $r6
; CHECK-NEXT:    #DEBUG_VALUE: warn:len <- $r3
; CHECK-NEXT:    #DEBUG_VALUE: warn:src <- $r2
; CHECK-NEXT:    r5 = r6
; CHECK-NEXT:    r5 += r4
; CHECK-NEXT:    r0 = r2
; CHECK-NEXT:    r0 += r4
; CHECK-NEXT:    w0 = *(u8 *)(r0 + 0)
; CHECK-NEXT:    *(u8 *)(r5 + 0) = w0
; CHECK-NEXT:    r4 += 1
; CHECK-NEXT:    if r4 < r3 goto LBB0_2
; CHECK-NEXT:  .Ltmp7:
; CHECK-NEXT:  .Ltmp8:
; CHECK-NEXT:  LBB0_3: # %post-loop-memcpy-expansion
; CHECK-NEXT:    #DEBUG_VALUE: warn:dst <- $r6
; CHECK-NEXT:    #DEBUG_VALUE: warn:len <- $r3
; CHECK-NEXT:    #DEBUG_VALUE: warn:src <- $r2
; CHECK-NEXT:    .loc 1 7 2 is_stmt 1 # warn_call.c:7:2
; CHECK-NEXT:  .Ltmp9:
; CHECK-NEXT:    r1 = r6
; CHECK-NEXT:    call foo
; CHECK-NEXT:  .Ltmp10:
; CHECK-NEXT:  .Ltmp11:
; CHECK-NEXT:    .loc 1 8 9 # warn_call.c:8:9
; CHECK-NEXT:  .Ltmp12:
; CHECK-NEXT:    r1 = r6
; CHECK-NEXT:    call bar
; CHECK-NEXT:    .loc 1 8 2 is_stmt 0 # warn_call.c:8:2
; CHECK-NEXT:  .Ltmp13:
; CHECK-NEXT:    exit
; CHECK-NEXT:  .Ltmp14:
; CHECK-NEXT:  .Ltmp15:
  tail call void @llvm.dbg.value(metadata ptr %0, i64 0, metadata !14, metadata !17), !dbg !18
  tail call void @llvm.dbg.value(metadata ptr %1, i64 0, metadata !15, metadata !17), !dbg !19
  tail call void @llvm.dbg.value(metadata i64 %2, i64 0, metadata !16, metadata !17), !dbg !20
  tail call void @llvm.memcpy.p0.p0.i64(ptr %0, ptr %1, i64 %2, i1 false), !dbg !21
  %4 = tail call ptr @foo(ptr %0, ptr %1, i64 %2) #5, !dbg !22
  %5 = tail call fastcc ptr @bar(ptr %0), !dbg !23
  ret ptr %5, !dbg !24
}

; Function Attrs: argmemonly nounwind
declare void @llvm.memcpy.p0.p0.i64(ptr nocapture writeonly, ptr nocapture readonly, i64, i1) #1

declare ptr @foo(ptr, ptr, i64) local_unnamed_addr #2

; Function Attrs: noinline nounwind readnone
define internal fastcc ptr @bar(ptr readnone returned) unnamed_addr #3 !dbg !25 {
; CHECK-LABEL: bar:
; CHECK:       .Lfunc_begin1:
; CHECK-NEXT:    .loc 1 2 0 is_stmt 1 # warn_call.c:2:0
; CHECK-NEXT:    .cfi_startproc
; CHECK-NEXT:  # %bb.0:
; CHECK-NEXT:    r0 = r1
; CHECK-NEXT:    #DEBUG_VALUE: bar:src <- 0
; CHECK-NEXT:    #DEBUG_VALUE: bar:len <- 0
; CHECK-NEXT:  .Ltmp16:
; CHECK-NEXT:    .loc 1 2 93 prologue_end # warn_call.c:2:93
; CHECK-NEXT:  .Ltmp17:
; CHECK-NEXT:  .Ltmp18:
; CHECK-NEXT:    exit
; CHECK-NEXT:  .Ltmp19:
; CHECK-NEXT:  .Ltmp20:
  tail call void @llvm.dbg.value(metadata ptr null, i64 0, metadata !28, metadata !17), !dbg !30
  tail call void @llvm.dbg.value(metadata i64 0, i64 0, metadata !29, metadata !17), !dbg !31
  ret ptr %0, !dbg !32
}

; Function Attrs: nounwind readnone
declare void @llvm.dbg.value(metadata, i64, metadata, metadata) #4

!llvm.dbg.cu = !{!0}
!llvm.module.flags = !{!3, !4}
!llvm.ident = !{!5}

!0 = distinct !DICompileUnit(language: DW_LANG_C99, file: !1, producer: "clang version 5.0.0 (trunk 292174) (llvm/trunk 292179)", isOptimized: true, runtimeVersion: 0, emissionKind: FullDebug, enums: !2)
!1 = !DIFile(filename: "warn_call.c", directory: "/w/llvm/bld")
!2 = !{}
!3 = !{i32 2, !"Dwarf Version", i32 4}
!4 = !{i32 2, !"Debug Info Version", i32 3}
!5 = !{!"clang version 5.0.0 (trunk 292174) (llvm/trunk 292179)"}
!6 = distinct !DISubprogram(name: "warn", scope: !1, file: !1, line: 4, type: !7, isLocal: false, isDefinition: true, scopeLine: 5, flags: DIFlagPrototyped, isOptimized: true, unit: !0, retainedNodes: !13)
!7 = !DISubroutineType(types: !8)
!8 = !{!9, !9, !10, !12}
!9 = !DIDerivedType(tag: DW_TAG_pointer_type, baseType: null, size: 64)
!10 = !DIDerivedType(tag: DW_TAG_pointer_type, baseType: !11, size: 64)
!11 = !DIDerivedType(tag: DW_TAG_const_type, baseType: null)
!12 = !DIBasicType(name: "long unsigned int", size: 64, encoding: DW_ATE_unsigned)
!13 = !{!14, !15, !16}
!14 = !DILocalVariable(name: "dst", arg: 1, scope: !6, file: !1, line: 4, type: !9)
!15 = !DILocalVariable(name: "src", arg: 2, scope: !6, file: !1, line: 4, type: !10)
!16 = !DILocalVariable(name: "len", arg: 3, scope: !6, file: !1, line: 4, type: !12)
!17 = !DIExpression()
!18 = !DILocation(line: 4, column: 18, scope: !6)
!19 = !DILocation(line: 4, column: 35, scope: !6)
!20 = !DILocation(line: 4, column: 54, scope: !6)
!21 = !DILocation(line: 6, column: 2, scope: !6)
!22 = !DILocation(line: 7, column: 2, scope: !6)
!23 = !DILocation(line: 8, column: 9, scope: !6)
!24 = !DILocation(line: 8, column: 2, scope: !6)
!25 = distinct !DISubprogram(name: "bar", scope: !1, file: !1, line: 2, type: !7, isLocal: true, isDefinition: true, scopeLine: 2, flags: DIFlagPrototyped, isOptimized: true, unit: !0, retainedNodes: !26)
!26 = !{!27, !28, !29}
!27 = !DILocalVariable(name: "dst", arg: 1, scope: !25, file: !1, line: 2, type: !9)
!28 = !DILocalVariable(name: "src", arg: 2, scope: !25, file: !1, line: 2, type: !10)
!29 = !DILocalVariable(name: "len", arg: 3, scope: !25, file: !1, line: 2, type: !12)
!30 = !DILocation(line: 2, column: 67, scope: !25)
!31 = !DILocation(line: 2, column: 86, scope: !25)
!32 = !DILocation(line: 2, column: 93, scope: !25)
